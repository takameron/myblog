---
title: "Microsoft365でユーザをテナント間移動"
date: 2022-04-29T16:42:00+09:00
lastmod: 2022-04-29T16:42:00+09:00
author: "たかめろん"
images: ["https://res.cloudinary.com/tsukayaku/image/upload/v1580351953/Blog-personal/thumbnail/app.jpg"]
categories: ["ソフトウェア・サービス"]
tags: ["Microsoft365"]
archives: ["2022","2022-04"]
toc: true
draft: false
---

以前[お名前.comでOffice 365 Business Essentialsを契約しました](/post/onamae_o365_bizesl/)。それから時が経ち、サービス名は変わり、価格も変わりました。お名前.comで契約するとテナント名は自動で割り当てられますが、自分で設定したかったため、Microsoftに切り替えることにしました。

お名前.comからMicrosoftへ切り替えるのにとても手間取ったため、手順のメモを残しておきます。自分向けのメモですので、説明は簡素で、かつ再現できないかもしれないですが、ご容赦ください。

移行する項目は下記5つです。

- メール
- OneDrive
- OneNote
- ToDo
- Forms

お名前.com側のテナントを旧テナント、Microsoft側のテナントを新テナントとして手順を書いていきます。

## メール

まずはメール(Exchange Online)について、受信するテナントの変更手順とデータの移動手順を書いていきます。

### 受信先変更

旧テナントで受信していたメールを新テナントで受け取れるようにします。

1. 退避用メールサーバ起動
2. DNSのMXレコードを退避用メールサーバに向ける
3. 旧テナントから独自ドメインを削除
4. 新テナントを作成する
5. 新テナントに独自ドメインを追加

テナント移行中に受信したメールを取りこぼさないため、退避用にメールサーバを建てます。私はConoHaのメールサーバを契約しました。1時間単位で課金されるので一時的に使いたい時に便利ですし、アカウント設定もやりやすかったです。

退避用メールサーバを建てたら、そちらで受信できるよう、独自ドメインのDNSのMXレコードを書き換えます。

旧テナントに独自ドメインを登録したままだと、新テナントでそのドメインを登録できません。そのため、旧テナントで独自ドメインを削除します。独自ドメインで作っていたアカウントは、デフォルトドメインのものに置き換わるようです。エラーが表示された場合は、デフォルトドメインのユーザを使うなど、適宜対応してください。

ようやく新テナントを作成します。プランは、Exchange Onlineに対応しているものを選択してください。ここでは独自ドメインを使ったユーザを作成できます。

新テナントのセットアップの最中に独自ドメインのセットアップがあると思います。DNSのレコードには旧テナントの残骸があると思いますが、新規追加されたり値が変更されているものは反映させ、変わらないものはそのままでいいと思います。

これで、独自ドメイン宛のメールが新テナントに届くようになったはずです。

### データ移動

データ移動は、Thunderbirdというメーラーで手動でやります。あぁめんどくせぇという感じですが、公式ツールは提供されていないようですし、この方法が一番簡単っぽいです。

1. Thunderbirdで旧テナントと新テナントにログイン
2. ちょっとずつメールをドラッグ＆ドロップで移動させる
3. 「[Remove Duplicate Messages](https://addons.thunderbird.net/ja/thunderbird/addon/removedupes/)」という拡張機能をインストール
4. 重複メッセージを削除

最初に、Thunderbirdで旧テナントの移動元のアカウント、新テナントの移動先のアカウント、両方にログインします。ログイン方法は[こちらの記事](/post/thunderbird_exchange_online/)が参考になるかもしれません。

移動元の受信トレイから移動先の受信トレイへ、メールを選択してドラッグ＆ドロップで移動させます。たくさん移動させると途中でエラーが発生し止まってしまうため、20個程度を選択していくと良さそうです。

ただ、おそらくエラーは発生すると思います。エラーが発生すると一部のメールだけがコピーされた状態になります。もう一度ドラッグ＆ドロップして成功すると、移動元のメールは削除され、移動先には失敗した時に運よくコピーされた分と成功した時の分の同じメールが複数存在する状態になります。そのため、「[Remove Duplicate Messages](https://addons.thunderbird.net/ja/thunderbird/addon/removedupes/)」という拡張機能を使用し、重複メールを検出して1個だけ残して削除してもらいます。使用方法は[こちらのWebサイト](https://www.qam-web.com/?p=18399)が参考になります。

## OneDrive, SharePoint

とうとう本丸といいますか、おそらく最も重要なサービスかつデータ量が多くて移行が大変なOneDriveに取り掛かります。

[Mover](https://mover.io/index.html)というサービスを利用します。このサービスはGoogle Workspace DriveやDropboxなどからMicrosoft 365 OneDriveなどにデータをコピーする機能を提供していて、テナント間のコピーも可能です。最近Microsoftに買収されたようなので、実質公式のツールだと言えそうです。

[こちらのWebサイト](https://mitsushima.work/archives/26401333.html)の通りに進めていきます。

以下に手順を簡単にメモします。

1. エンタープライズアプリケーションにmoverを追加
2. 各種許可を設定（VPNを使っているとグローバル管理者なのに権限がないと表示された）
3. moverにサインイン
4. moverでsourceとtargetを設定
5. ユーザを追加(Auto detect的なやつ)
6. moverで移動させるアカウントを選ぶ
7. とりあえずscanする
8. 良さげならmigrate

変更日時などのメタデータも保持したままコピーしてくれるので便利です。200GB程度のデータをコピーするのに1日くらいかかりました。

15GBを超えるファイルはファイルサイズ制限に引っかかって失敗します。自分でダウンロード＆アップロードする必要があります（ログを見てfaildになっているものを確認）。OneDriveのデスクトップアプリは不安定でうまく使えなかったため、Cyberduckを使用しました。Cyberduckでコピーすると8割ほど進んだ後に振り出しに戻ったり、100%になっても全然終わる気配がなかったりと色々と心配になりますが、1日ほどパソコンを放置したら完了していました。

## OneNote

[こちらのWebサイト](https://www.tipsfound.com/onenote/03003)で紹介されている手順通りにやっていくと良さそうです。

下記に手順をメモします。

1. デスクトップ版OneNoteで旧テナントのアカウントと新テナントのアカウントにログイン
2. 新テナントに移行先ノートブックを新規作成する
3. 旧テナントの移行元ノートブックを開き、移動させるセクションを右クリック
4. 「移動/コピー」をクリックし、移行先ノートブックを選択して「移動」をクリック

上記の操作を繰り返すことで、全部移動できます。手間がかかりますが。

## ToDo, Forms

Microsoft ToDoとFormは、全手動で、移行元の情報を見て移行先に入力する、という手順しか思いつきませんでした。

---

これで新テナントにだいたい移行できたと思います。あとはPower AutomateやTeamsなどが残っているかと思います。

会社や部署の統廃合を考えればテナント間のユーザ移動の需要はあると思いますが、Microsoft公式の移行ツールはなぜ無いのでしょうか。Microsoft365は設定項目がとてもたくさんあり、複雑に絡まっているので、やっぱりツールを作るのが大変で難しいからなのかな？
